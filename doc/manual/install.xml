<?xml version="1.0" encoding="UTF-8"?>
<chapter id="installation">
  <title>Installation</title>

  <warning>
    <para>Netatalk 2 cannot coexist with either Netatalk 1 or Netatalk 3.
    See the respective chapters on upgrading to get to know the differences.</para>
  </warning>

  <para></para>

  <sect1>
    <title>How to obtain Netatalk</title>

    <para>Please have a look at the netatalk page on GitHub for the most
    recent informations on this issue.</para>

    <para><ulink
    url="https://github.com/Netatalk/netatalk">https://github.com/Netatalk/netatalk</ulink></para>

    <sect2>
      <title>Binary packages</title>

      <para>Binary packages of Netatalk are included in some Linux and UNIX
      distributions. You might want to have a look at the usual locations,
      too.</para>

      <para>Ubuntu package: <ulink
      url="https://launchpad.net/ubuntu">https://launchpad.net/ubuntu
      </ulink></para>

      <para>Debian package: <ulink
      url="https://www.debian.org/distrib/packages">https://www.debian.org/distrib/packages
      </ulink></para>

      <para>Various RPM packages: <ulink
      url="https://rpmfind.net/">https://rpmfind.net/ </ulink></para>

      <para>Fedora/RHEL package: <ulink
      url="https://koji.fedoraproject.org/koji/search">https://koji.fedoraproject.org/koji/search
      </ulink></para>

      <para>Gentoo package: <ulink
      url="https://packages.gentoo.org/">https://packages.gentoo.org/
      </ulink></para>

      <para>openSUSE package: <ulink
      url="https://software.opensuse.org/">https://software.opensuse.org/
      </ulink></para>

      <para>Solaris package: <ulink
      url="https://www.opencsw.org/packages/CSWnetatalk/">https://www.opencsw.org/
      </ulink></para>

      <para>FreeBSD ports: <ulink
      url="https://www.freebsd.org/ports/">https://www.freebsd.org/ports/
      </ulink></para>

      <para>NetBSD pkgsrc: <ulink
      url="https://pkgsrc.se/search.php">https://pkgsrc.se/search.php
      </ulink></para>

      <para>OpenBSD ports:<ulink
      url="https://openports.pl">https://openports.pl
      </ulink></para>

      <para>macOS MacPorts:<ulink
      url="https://ports.macports.org/">https://ports.macports.org/
      </ulink></para>

      <para>etc.<indexterm>
          <primary>RPM</primary>

          <secondary>Red Hat Package Manager package</secondary>
        </indexterm><indexterm>
          <primary>Deb</primary>

          <secondary>Debian package</secondary>
        </indexterm><indexterm>
          <primary>Ports</primary>

          <secondary>FreeBSD port</secondary>
        </indexterm></para>
    </sect2>

    <sect2>
      <title>Source packages</title>

      <sect3>
        <title>Tarballs</title>

        <para>Prepacked tarballs in .tar.xz and tar.bz2 format are available
        on the <ulink
        url="https://github.com/Netatalk/netatalk/releases">GitHub releases page</ulink>.</para>
      </sect3>

      <sect3>
        <title>Git</title>

        <para>Downloading the Git repository can be done quickly and
        easily:</para>

        <orderedlist>
          <listitem>
            <para>Make sure you have Git installed. <command>which
            git</command> should produce a path to git.</para>

            <screen><prompt>$</prompt> <userinput>which git</userinput>
<computeroutput>/usr/bin/git</computeroutput></screen>
          </listitem>

          <listitem>
            <para>Now get the source:</para>

            <screen><prompt>$</prompt> <userinput>git clone https://github.com/Netatalk/netatalk.git netatalk-code
</userinput><computeroutput>Cloning into 'netatalk-code'...
remote: Enumerating objects: 41592, done.
...
Resolving deltas: 100% (32227/32227), done.
</computeroutput></screen>

            <para>This will create a local directory called
            <filename>netatalk-code</filename> containing a complete and fresh
            copy of the whole Netatalk source tree from the Git repository.</para>
          </listitem>

          <listitem>
            <para>If you don't specify a branch or tag,
            you will get the bleeding edge development code.
            In order to get the latest stable Netatalk 2.4 code, for instance,
            check out the branch named "branch-netatalk-2-4":</para>

            <screen><prompt>$</prompt> <userinput>git checkout branch-netatalk-2-4</userinput></screen>
          </listitem>

          <listitem>
            <para>In order to keep your repository copy updated, occasionally
            run:</para>

            <screen><prompt>$</prompt> <userinput>git pull</userinput></screen>
          </listitem>

          <listitem>
            <para>Now <command>cd</command> to the netatalk directory and run
            <command>./bootstrap</command>. This will create the
            <filename>configure</filename> script required in the next
            step.</para>

            <screen><prompt>$</prompt> <userinput>./bootstrap</userinput></screen>
          </listitem>
        </orderedlist>

        <para>For futher information refer to the <ulink
        url="https://github.com/Netatalk/netatalk/blob/main/INSTALL">INSTALL</ulink>
        file.</para>
      </sect3>
    </sect2>
  </sect1>

  <sect1>
    <title>Compiling Netatalk</title>

    <sect2>
      <title>Prerequisites</title>

      <note>
        <para>The following pieces of software are likely to have a package
        available for your OS distribution of choice.</para>

        <para>Please see the <ulink
        url="https://netatalk.io/docs/">
        Netatalk wiki docs</ulink> for OS specific installation guides.</para>
      </note>

      <sect3>
        <title>System requirements</title>

        <para>Your system needs to meet the following requirements:</para>

        <itemizedlist>
          <listitem>
            <para>A C compiler, Netatalk compiles fine with gcc &gt;
            2.7.95</para>
          </listitem>
        </itemizedlist>

        <para>To be able to compile with AFP3 support, your system has to
        support large files (&gt;2GB).</para>

        <note>
          <para>On linux systems glibc &gt; 2.2 is required.</para>
        </note>

        <para></para>
      </sect3>

      <sect3>
        <title>Required third-party software</title>

        <para>Netatalk makes use of Berkeley DB<indexterm>
            <primary>BDB</primary>

            <secondary>Berkeley DB</secondary>
          </indexterm>. At the time of writing, the following versions are
        supported:</para>

        <itemizedlist>
          <listitem>
            <para>minimum 4.6.x</para>
          </listitem>
          <listitem>
            <para>recommended 5.3.x</para>
          </listitem>
        </itemizedlist>

      </sect3>

      <sect3>
        <title>Optional third-party software</title>

        <para>Netatalk can use the following third-party software to enhance
        its functionality.</para>

        <itemizedlist>
          <listitem>
            <para>Libgcrypt (recommended) and OpenSSL</para>

            <para>Required for encrypted passwords. Without it, the password
            will be sent over the network in clear text. Libgcrypt is needed
            for DHX2. OpenSSL 1.x or LibreSSL is needed for the older DHCAST128 (aka
            DHX).</para>
          </listitem>

          <listitem>
            <para>OpenSLP</para>

            <para>SLP<indexterm>
                <primary>SLP</primary>

                <secondary>Service Location Protocol</secondary>
              </indexterm> (Service Location Protocol) is an IETF<indexterm>
                <primary>IETF</primary>

                <secondary>Internet Engineering Task Force</secondary>
              </indexterm> standards track protocol that provides a framework
            to allow networking applications to discover the existence,
            location, and configuration of networked services in enterprise
            networks.</para>

            <para>Mac OS 8.5 - Mac OS X 10.4 use SLP to locate AFP
            servers.</para>
          </listitem>

          <listitem>
            <para>Avahi or mDNSResponder</para>

            <para>Mac OS X 10.2 and later prefer Bonjour (aka Zeroconf).
            Netatalk can advertise AFP server and Time Machine volume by using
            Avahi or mDNSResponder.</para>

            <para>Avahi is a freely-available implementation of Zeroconf.
            Avahi itself must be built with DBUS support (
              <userinput>--enable-dbus</userinput>).</para>

            <para>Starting with Netatalk 2.2.3, mDNSResponder is also available.
            </para>
          </listitem>

          <listitem>
            <para>TCP wrappers</para>

            <para>Wietse Venema's network logger, also known as TCPD or
            LOG_TCP.</para>

            <para>Security options are: access control per host, domain and/or
            service; detection of host name spoofing or host address spoofing;
            booby traps to implement an early-warning system.</para>
          </listitem>

          <listitem>
            <para>PAM<indexterm>
                <primary>PAM</primary>

                <secondary>Pluggable Authentication Modules</secondary>
              </indexterm></para>

            <para>PAM provides a flexible mechanism for authenticating users.
            PAM was invented by SUN<indexterm>
                <primary>SUN</primary>

                <secondary>Sun Microsystems</secondary>
              </indexterm> Microsystems. Linux-PAM is a suite of shared
            libraries that enable the local system administrator to choose how
            applications authenticate users.</para>

          </listitem>

          <listitem>
            <para>iconv</para>

            <para>iconv provides conversion routines for many character
            encodings. Netatalk uses it to provide charsets it does not have
            built in conversions for, like ISO-8859-1. On glibc systems,
            Netatalk can use the glibc provided iconv implementation.
            Otherwise you can use the GNU libiconv implementation.</para>
          </listitem>
        </itemizedlist>
      </sect3>
    </sect2>

    <sect2 id="compiling-netatalk">
      <title>Compiling<indexterm>
          <primary>Compile</primary>

          <secondary>Compiling Netatalk from Source</secondary>
        </indexterm> Netatalk</title>

      <sect3>
        <title>Configuring the build</title>

        <para>To build the binaries, first run the program
        <command>./configure</command> in the source directory. This should
        automatically configure Netatalk for your operating system. If you
        have unusual needs, then you may wish to run</para>

        <screen><prompt>$</prompt> <userinput>./configure --help</userinput></screen>

        <para>to see what special options you can enable.</para>

        <para>The most used configure options are:</para>

        <itemizedlist>
          <listitem>
            <para>--enable-[systemd/redhat-sysv/suse-sysv/gentoo/debian/netbsd/macos]</para>

            <para>This option helps netatalk to determine where to install the
            start scripts.</para>

            <para>The <command>--enable-systemd</command> option is
            cross-platform and should work with most contemporary Linux or *BSD
            distributions that have adopted systemd.</para>
          </listitem>

          <listitem>
            <para><option>--with-bdb</option>=<replaceable>/path/to/bdb/installation/</replaceable></para>

            <para>In case you installed Berkeley DB in a non-standard
            location, you will <emphasis>have</emphasis> to give the install
            location to netatalk, using this switch.</para>
          </listitem>

          <listitem>
            <para><option>--with-ssl-dir</option>=<replaceable>/path/to/ssl/installation/</replaceable></para>

            <para>In case you installed OpenSSL or LibreSSL in a non-standard
            location, you will <emphasis>have</emphasis> to give the install
            location to Netatalk, using this switch.</para>
          </listitem>
        </itemizedlist>

        <para>Now run configure with any options you need</para>

        <screen><prompt>$</prompt> <userinput>./configure [arguments] [--with-bdb=/bdb/install/path]</userinput></screen>

        <para>Configure will end up in an overview showing the settings the
        Netatalk Makefiles have been created with.</para>

        <para>If this step fails please visit the <ulink
        url="https://github.com/Netatalk/netatalk/wiki/Troubleshooting">troubleshooting
        guide</ulink>.</para>

        <para>Next, running</para>

        <screen><prompt>$</prompt> <userinput>make</userinput></screen>

        <para>should produce the Netatalk binaries (this step can take several
        minutes to complete).</para>

        <para>When the process finished you can use</para>

        <screen><prompt>$</prompt> <userinput>make install</userinput></screen>

        <para>to install the binaries and documentation (must be done as
        "root" when using default locations).</para>
      </sect3>
    </sect2>
  </sect1>
</chapter>
