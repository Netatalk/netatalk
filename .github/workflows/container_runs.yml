name: Container Test Runs
on:
  workflow_run:
    workflows: [Build Containers]
    types: 
      - completed

permissions: read-all
env:
    REGISTRY: ghcr.io

jobs:
    afp-spectest-afp34-prod:
        name: AFP spec test (cnid:dbd) AFP 3.4 - Alpine (Prod)
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Create Docker network
              run: |
                docker network create afp_network
            - name: Run Netatalk
              run: |
                docker run --detach \
                    --name afp_server \
                    --network afp_network \
                    -e AFP_USER=atalk1 \
                    -e AFP_USER2=atalk2 \
                    -e AFP_PASS=${{ secrets.AFP_PASSWD }} \
                    -e AFP_PASS2=${{ secrets.AFP_PASSWD }} \
                    -e AFP_GROUP=afpusers \
                    -e SHARE_NAME=test1 \
                    -e SHARE_NAME2=test2 \
                    -e INSECURE_AUTH=1 \
                    -e DISABLE_TIMEMACHINE=1 \
                    -e AFP_EXTMAP=1 \
                    ${{ env.REGISTRY }}/netatalk/netatalk:${{ github.sha }}
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                    --network afp_network \
                    -e AFP_USER=atalk1 \
                    -e AFP_USER2=atalk2 \
                    -e AFP_PASS=${{ secrets.AFP_PASSWD }} \
                    -e AFP_PASS2=${{ secrets.AFP_PASSWD }} \
                    -e AFP_GROUP=afpusers \
                    -e SHARE_NAME=test1 \
                    -e SHARE_NAME2=test2 \
                    -e VERBOSE=1 \
                    -e TESTSUITE=spectest \
                    -e AFP_VERSION=7 \
                    -e AFP_REMOTE=1 \
                    -e AFP_HOST=afp_server \
                    ${{ env.REGISTRY }}/netatalk/netatalk-testsuite:${{ github.sha }}

    afp-spectest-mysql-afp34-prod:
        name: AFP spec test (cnid:mysql) AFP 3.4 - Alpine (Prod)
        runs-on: ubuntu-latest
        timeout-minutes: 10
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Create container network
              run: |
                docker network create afp_network
            - name: Start MariaDB
              run: |
                docker run --detach --name mariadb --network afp_network \
                    -e MARIADB_ROOT_PASSWORD=${{ secrets.MARIADB_ROOT_PASSWORD }} \
                    mariadb:latest
            - name: Wait for MariaDB to initialize
              run: |
                sleep 4
            - name: Start Netatalk
              run: |
                docker run --detach \
                    --name afp_server \
                    --network afp_network \
                    -e AFP_USER=atalk1 \
                    -e AFP_USER2=atalk2 \
                    -e AFP_PASS=${{ secrets.AFP_PASSWD }} \
                    -e AFP_PASS2=${{ secrets.AFP_PASSWD }} \
                    -e AFP_GROUP=afpusers \
                    -e AFP_CNID_BACKEND=mysql \
                    -e SHARE_NAME=test1 \
                    -e SHARE_NAME2=test2 \
                    -e INSECURE_AUTH=1 \
                    -e DISABLE_TIMEMACHINE=1 \
                    -e AFP_EXTMAP=1 \
                    -e AFP_CNID_SQL_HOST=mariadb \
                    -e AFP_CNID_SQL_PASS=${{ secrets.MARIADB_ROOT_PASSWORD }} \
                    ${{ env.REGISTRY }}/netatalk/netatalk:${{ github.sha }}
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                    --network afp_network \
                    -e AFP_USER=atalk1 \
                    -e AFP_USER2=atalk2 \
                    -e AFP_PASS=${{ secrets.AFP_PASSWD }} \
                    -e AFP_PASS2=${{ secrets.AFP_PASSWD }} \
                    -e AFP_GROUP=afpusers \
                    -e SHARE_NAME=test1 \
                    -e SHARE_NAME2=test2 \
                    -e VERBOSE=1 \
                    -e TESTSUITE=spectest \
                    -e AFP_VERSION=7 \
                    -e AFP_REMOTE=1 \
                    -e AFP_HOST=afp_server \
                    -e AFP_CNID_SQL_HOST=mariadb \
                    -e AFP_CNID_SQL_PASS=${{ secrets.MARIADB_ROOT_PASSWORD }} \
                    ${{ env.REGISTRY }}/netatalk/netatalk-testsuite:${{ github.sha }}

    afp-spectest-mysql-afp34-debian:
        name: AFP spec test (cnid:mysql) AFP 3.4 - Debian
        runs-on: ubuntu-latest
        timeout-minutes: 10
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Create container network
              run: |
                docker network create afp_network
            - name: Start MariaDB container
              run: |
                docker run --detach --name mariadb --network afp_network \
                    -e MARIADB_ROOT_PASSWORD=${{ secrets.MARIADB_ROOT_PASSWORD }} \
                    mariadb:latest
            - name: Wait for MariaDB to initialize
              run: |
                sleep 4
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                    --network afp_network \
                    -e AFP_USER=atalk1 \
                    -e AFP_USER2=atalk2 \
                    -e AFP_PASS=${{ secrets.AFP_PASSWD }} \
                    -e AFP_PASS2=${{ secrets.AFP_PASSWD }} \
                    -e AFP_GROUP=afpusers \
                    -e AFP_CNID_BACKEND=mysql \
                    -e SHARE_NAME=test1 \
                    -e SHARE_NAME2=test2 \
                    -e INSECURE_AUTH=1 \
                    -e DISABLE_TIMEMACHINE=1 \
                    -e VERBOSE=1 \
                    -e TESTSUITE=spectest \
                    -e AFP_VERSION=7 \
                    -e AFP_REMOTE=1 \
                    -e AFP_EXTMAP=1 \
                    -e AFP_CNID_SQL_HOST=mariadb \
                    -e AFP_CNID_SQL_PASS=${{ secrets.MARIADB_ROOT_PASSWORD }} \
                    ${{ env.REGISTRY }}/netatalk/netatalk-testsuite-debian:${{ github.sha }}

    afp-spectest-sqlite-afp34:
        name: AFP spec test (cnid:sqlite) AFP 3.4 - Alpine
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_USER2="atalk2" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_PASS2="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e AFP_CNID_BACKEND="sqlite" \
                  -e SHARE_NAME="test1" \
                  -e SHARE_NAME2="test2" \
                  -e INSECURE_AUTH="1" \
                  -e DISABLE_TIMEMACHINE="1" \
                  -e VERBOSE="1" \
                  -e TESTSUITE="spectest" \
                  -e AFP_VERSION="7" \
                  -e AFP_EXTMAP="1" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite:${{ github.sha }}

    afp-spectest-sqlite-afp34-debian:
        name: AFP spec test (cnid:sqlite) AFP 3.4 - Debian
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_USER2="atalk2" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_PASS2="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e AFP_CNID_BACKEND="sqlite" \
                  -e SHARE_NAME="test1" \
                  -e SHARE_NAME2="test2" \
                  -e INSECURE_AUTH="1" \
                  -e DISABLE_TIMEMACHINE="1" \
                  -e VERBOSE="1" \
                  -e TESTSUITE="spectest" \
                  -e AFP_VERSION="7" \
                  -e AFP_EXTMAP="1" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite-debian:${{ github.sha }}

    afp-spectest-afp34:
        name: AFP spec test (ea:sys) AFP 3.4 - Alpine
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_USER2="atalk2" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_PASS2="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e SHARE_NAME="test1" \
                  -e SHARE_NAME2="test2" \
                  -e INSECURE_AUTH="1" \
                  -e DISABLE_TIMEMACHINE="1" \
                  -e VERBOSE="1" \
                  -e TESTSUITE="spectest" \
                  -e AFP_VERSION="7" \
                  -e AFP_EXTMAP="1" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite:${{ github.sha }}

    afp-spectest-afp34-debian:
        name: AFP spec test (ea:sys) AFP 3.4 - Debian
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_USER2="atalk2" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_PASS2="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e SHARE_NAME="test1" \
                  -e SHARE_NAME2="test2" \
                  -e INSECURE_AUTH="1" \
                  -e DISABLE_TIMEMACHINE="1" \
                  -e VERBOSE="1" \
                  -e TESTSUITE="spectest" \
                  -e AFP_VERSION="7" \
                  -e AFP_EXTMAP="1" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite-debian:${{ github.sha }}

    afp-adtest-afp34:
        name: AFP spec test (ea:ad) AFP 3.4 - Alpine
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_USER2="atalk2" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_PASS2="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e SHARE_NAME="test1" \
                  -e SHARE_NAME2="test2" \
                  -e INSECURE_AUTH="1" \
                  -e DISABLE_TIMEMACHINE="1" \
                  -e VERBOSE="1" \
                  -e AFP_ADOUBLE="1" \
                  -e TESTSUITE="spectest" \
                  -e AFP_VERSION="7" \
                  -e AFP_EXTMAP="1" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite:${{ github.sha }}

    afp-adtest-afp34-debian:
        name: AFP spec test (ea:ad) AFP 3.4 - Debian
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_USER2="atalk2" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_PASS2="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e SHARE_NAME="test1" \
                  -e SHARE_NAME2="test2" \
                  -e INSECURE_AUTH="1" \
                  -e DISABLE_TIMEMACHINE="1" \
                  -e VERBOSE="1" \
                  -e AFP_ADOUBLE="1" \
                  -e TESTSUITE="spectest" \
                  -e AFP_VERSION="7" \
                  -e AFP_EXTMAP="1" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite-debian:${{ github.sha }}

    afp-spectest-afp33:
        name: AFP spec test (ea:sys) AFP 3.3 - Alpine
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_USER2="atalk2" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_PASS2="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e SHARE_NAME="test1" \
                  -e SHARE_NAME2="test2" \
                  -e INSECURE_AUTH="1" \
                  -e DISABLE_TIMEMACHINE="1" \
                  -e VERBOSE="1" \
                  -e TESTSUITE="spectest" \
                  -e AFP_VERSION="6" \
                  -e AFP_EXTMAP="1" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite:${{ github.sha }}

    afp-spectest-afp32:
        name: AFP spec test (ea:sys) AFP 3.2 - Alpine
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_USER2="atalk2" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_PASS2="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e SHARE_NAME="test1" \
                  -e SHARE_NAME2="test2" \
                  -e INSECURE_AUTH="1" \
                  -e DISABLE_TIMEMACHINE="1" \
                  -e VERBOSE="1" \
                  -e TESTSUITE="spectest" \
                  -e AFP_VERSION="5" \
                  -e AFP_EXTMAP="1" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite:${{ github.sha }}

    afp-spectest-afp31:
        name: AFP spec test (ea:sys) AFP 3.1 - Alpine
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_USER2="atalk2" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_PASS2="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e SHARE_NAME="test1" \
                  -e SHARE_NAME2="test2" \
                  -e INSECURE_AUTH="1" \
                  -e DISABLE_TIMEMACHINE="1" \
                  -e VERBOSE="1" \
                  -e TESTSUITE="spectest" \
                  -e AFP_VERSION="4" \
                  -e AFP_EXTMAP="1" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite:${{ github.sha }}

    afp-spectest-afp30:
        name: AFP spec test (ea:sys) AFP 3.0 - Alpine
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_USER2="atalk2" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_PASS2="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e SHARE_NAME="test1" \
                  -e SHARE_NAME2="test2" \
                  -e INSECURE_AUTH="1" \
                  -e DISABLE_TIMEMACHINE="1" \
                  -e VERBOSE="1" \
                  -e TESTSUITE="spectest" \
                  -e AFP_VERSION="3" \
                  -e AFP_EXTMAP="1" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite:${{ github.sha }}

    afp-spectest-afp30-debian:
        name: AFP spec test (ea:sys) AFP 3.0 - Debian
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_USER2="atalk2" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_PASS2="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e SHARE_NAME="test1" \
                  -e SHARE_NAME2="test2" \
                  -e INSECURE_AUTH="1" \
                  -e DISABLE_TIMEMACHINE="1" \
                  -e VERBOSE="1" \
                  -e TESTSUITE="spectest" \
                  -e AFP_VERSION="3" \
                  -e AFP_EXTMAP="1" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite-debian:${{ github.sha }}

    afp-spectest-afp22:
        name: AFP spec test (ea:sys) AFP 2.2 - Alpine
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_USER2="atalk2" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_PASS2="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e SHARE_NAME="test1" \
                  -e SHARE_NAME2="test2" \
                  -e INSECURE_AUTH="1" \
                  -e DISABLE_TIMEMACHINE="1" \
                  -e VERBOSE="1" \
                  -e TESTSUITE="spectest" \
                  -e AFP_VERSION="2" \
                  -e AFP_EXTMAP="1" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite:${{ github.sha }}

    afp-spectest-afp21:
        name: AFP spec test (ea:sys) AFP 2.1 - Alpine
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_USER2="atalk2" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_PASS2="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e SHARE_NAME="test1" \
                  -e SHARE_NAME2="test2" \
                  -e INSECURE_AUTH="1" \
                  -e DISABLE_TIMEMACHINE="1" \
                  -e VERBOSE="1" \
                  -e TESTSUITE="spectest" \
                  -e AFP_VERSION="1" \
                  -e AFP_EXTMAP="1" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite:${{ github.sha }}

    afp-spectest-afp21-debian:
        name: AFP spec test (ea:sys) AFP 2.1 - Debian
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_USER2="atalk2" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_PASS2="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e SHARE_NAME="test1" \
                  -e SHARE_NAME2="test2" \
                  -e INSECURE_AUTH="1" \
                  -e DISABLE_TIMEMACHINE="1" \
                  -e VERBOSE="1" \
                  -e TESTSUITE="spectest" \
                  -e AFP_VERSION="1" \
                  -e AFP_EXTMAP="1" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite-debian:${{ github.sha }}

    afp-adtest-afp21:
        name: AFP spec test (ea:ad) AFP 2.1 - Alpine
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_USER2="atalk2" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_PASS2="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e SHARE_NAME="test1" \
                  -e SHARE_NAME2="test2" \
                  -e INSECURE_AUTH="1" \
                  -e DISABLE_TIMEMACHINE="1" \
                  -e VERBOSE="1" \
                  -e AFP_ADOUBLE="1" \
                  -e TESTSUITE="spectest" \
                  -e AFP_VERSION="1" \
                  -e AFP_EXTMAP="1" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite:${{ github.sha }}

    afp-adtest-afp21-debian:
        name: AFP spec test (ea:ad) AFP 2.1 - Debian
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_USER2="atalk2" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_PASS2="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e SHARE_NAME="test1" \
                  -e SHARE_NAME2="test2" \
                  -e INSECURE_AUTH="1" \
                  -e DISABLE_TIMEMACHINE="1" \
                  -e VERBOSE="1" \
                  -e AFP_ADOUBLE="1" \
                  -e TESTSUITE="spectest" \
                  -e AFP_VERSION="1" \
                  -e AFP_EXTMAP="1" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite-debian:${{ github.sha }}

    afp-rotest-afp34:
        name: AFP spec test (readonly) AFP 3.4 - Alpine
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e SHARE_NAME="test1" \
                  -e INSECURE_AUTH="1" \
                  -e VERBOSE="1" \
                  -e AFP_READONLY="1" \
                  -e TESTSUITE="readonly" \
                  -e AFP_VERSION="7" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite:${{ github.sha }}

    afp-rotest-afp21:
        name: AFP spec test (readonly) AFP 2.1 - Alpine
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e SHARE_NAME="test1" \
                  -e INSECURE_AUTH="1" \
                  -e VERBOSE="1" \
                  -e AFP_READONLY="1" \
                  -e TESTSUITE="readonly" \
                  -e AFP_VERSION="1" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite:${{ github.sha }}

    afp-logintest-afp34:
        name: AFP login test AFP 3.4 - Alpine
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e INSECURE_AUTH="1" \
                  -e VERBOSE="1" \
                  -e TESTSUITE="login" \
                  -e AFP_VERSION="7" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite:${{ github.sha }}

    afp-logintest-afp21:
        name: AFP login test AFP 2.1 - Alpine
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e INSECURE_AUTH="1" \
                  -e VERBOSE="1" \
                  -e TESTSUITE="login" \
                  -e AFP_VERSION="1" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite:${{ github.sha }}

    afp-lantest:
        name: AFP lantest - Alpine
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e SHARE_NAME="test1" \
                  -e INSECURE_AUTH="1" \
                  -e VERBOSE="1" \
                  -e TESTSUITE="lan" \
                  -e AFP_VERSION="7" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite:${{ github.sha }}

    afp-speedtest:
        name: AFP speedtest - Alpine
        runs-on: ubuntu-latest
        timeout-minutes: 5
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - name: Run Netatalk testsuite
              run: |
                docker run --rm \
                  -e AFP_USER="atalk1" \
                  -e AFP_PASS="${{ secrets.AFP_PASSWD }}" \
                  -e AFP_GROUP="afpusers" \
                  -e SHARE_NAME="test1" \
                  -e INSECURE_AUTH="1" \
                  -e VERBOSE="1" \
                  -e TESTSUITE="speed" \
                  -e AFP_VERSION="7" \
                  ${{ env.REGISTRY }}/netatalk/netatalk-testsuite:${{ github.sha }}
